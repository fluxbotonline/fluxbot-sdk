{"version":3,"sources":["../src/types.ts","../src/errors.ts","../src/client.ts"],"sourcesContent":["import { z } from 'zod';\n\n/**\n * Minimal types for a FluxBot-style API.\n * This SDK is intentionally \"dummy\" (pre-launch), but the shape matches the direction.\n */\n\nexport const HealthSchema = z.object({\n  ok: z.boolean().default(true),\n  version: z.string().optional(),\n  uptimeSec: z.number().optional(),\n  rpc: z\n    .object({\n      ok: z.boolean().optional(),\n      ms: z.number().optional(),\n      url: z.string().optional()\n    })\n    .optional(),\n  wss: z\n    .object({\n      ok: z.boolean().optional(),\n      lastLogAtMs: z.number().optional(),\n      subscribed: z.boolean().optional()\n    })\n    .optional()\n});\nexport type Health = z.infer<typeof HealthSchema>;\n\nexport const BotModeSchema = z.enum(['paper', 'live']);\nexport type BotMode = z.infer<typeof BotModeSchema>;\n\nexport const StartStopResponseSchema = z.object({ ok: z.boolean(), started: z.boolean().optional() });\nexport type StartStopResponse = z.infer<typeof StartStopResponseSchema>;\n\nexport const EventTypeSchema = z.enum([\n  'candidate',\n  'gate_skip',\n  'entry_skip',\n  'enter_attempt',\n  'enter_ok',\n  'enter_fail',\n  'exit_attempt',\n  'exit_retry',\n  'exit_ok',\n  'exit_fail',\n  'fast_exit',\n  'rug_risk',\n  'rug_confirm',\n  'rpc_down'\n]);\n\nexport const BotEventSchema = z.object({\n  id: z.string().optional(),\n  ts: z.number(),\n  type: EventTypeSchema,\n  mint: z.string().optional(),\n  signature: z.string().optional(),\n  message: z.string().optional(),\n  data: z.record(z.string(), z.any()).optional()\n});\nexport type BotEvent = z.infer<typeof BotEventSchema>;\n\nexport const EventsResponseSchema = z.object({ ok: z.boolean().default(true), events: z.array(BotEventSchema) });\nexport type EventsResponse = z.infer<typeof EventsResponseSchema>;\n\nexport type FluxBotClientOptions = {\n  baseUrl: string; // e.g. http://127.0.0.1:8787\n  apiKey?: string;\n  timeoutMs?: number;\n};\n","export class FluxBotError extends Error {\n  constructor(message: string, public readonly info?: unknown) {\n    super(message);\n    this.name = 'FluxBotError';\n  }\n}\n\nexport class FluxBotHttpError extends FluxBotError {\n  constructor(\n    message: string,\n    public readonly status: number,\n    public readonly url: string,\n    public readonly bodyText?: string\n  ) {\n    super(message, { status, url, bodyText });\n    this.name = 'FluxBotHttpError';\n  }\n}\n","import { FluxBotHttpError } from './errors';\nimport {\n  EventsResponse,\n  EventsResponseSchema,\n  FluxBotClientOptions,\n  Health,\n  HealthSchema,\n  StartStopResponse,\n  StartStopResponseSchema\n} from './types';\n\nfunction joinUrl(base: string, path: string) {\n  return base.replace(/\\/+$/, '') + '/' + path.replace(/^\\/+/, '');\n}\n\nasync function fetchJson<T>(url: string, init: RequestInit, timeoutMs: number): Promise<T> {\n  const ac = new AbortController();\n  const t = setTimeout(() => ac.abort(), timeoutMs);\n  try {\n    const res = await fetch(url, { ...init, signal: ac.signal });\n    const text = await res.text();\n    if (!res.ok) throw new FluxBotHttpError('HTTP error', res.status, url, text);\n    return text ? (JSON.parse(text) as T) : ({} as T);\n  } finally {\n    clearTimeout(t);\n  }\n}\n\nexport class FluxBotClient {\n  readonly baseUrl: string;\n  readonly apiKey?: string;\n  readonly timeoutMs: number;\n\n  constructor(opts: FluxBotClientOptions) {\n    this.baseUrl = opts.baseUrl;\n    this.apiKey = opts.apiKey;\n    this.timeoutMs = opts.timeoutMs ?? 15_000;\n  }\n\n  private headers(): Record<string, string> {\n    const h: Record<string, string> = { 'content-type': 'application/json' };\n    if (this.apiKey) h['x-api-key'] = this.apiKey;\n    return h;\n  }\n\n  async health(): Promise<Health> {\n    const url = joinUrl(this.baseUrl, 'status');\n    const json = await fetchJson<any>(url, { method: 'GET', headers: this.headers() }, this.timeoutMs);\n    // Accept both {status: {...}} and direct health object.\n    const candidate = json?.status ?? json;\n    return HealthSchema.parse(candidate);\n  }\n\n  async start(): Promise<StartStopResponse> {\n    const url = joinUrl(this.baseUrl, 'start');\n    const json = await fetchJson<any>(url, { method: 'POST', headers: this.headers(), body: '{}' }, this.timeoutMs);\n    return StartStopResponseSchema.parse(json);\n  }\n\n  async stop(): Promise<StartStopResponse> {\n    const url = joinUrl(this.baseUrl, 'stop');\n    const json = await fetchJson<any>(url, { method: 'POST', headers: this.headers(), body: '{}' }, this.timeoutMs);\n    return StartStopResponseSchema.parse(json);\n  }\n\n  async panicClose(): Promise<StartStopResponse> {\n    const url = joinUrl(this.baseUrl, 'panic-close');\n    const json = await fetchJson<any>(url, { method: 'POST', headers: this.headers(), body: '{}' }, this.timeoutMs);\n    return StartStopResponseSchema.parse(json);\n  }\n\n  async events(limit = 200): Promise<EventsResponse> {\n    const url = joinUrl(this.baseUrl, `events?limit=${encodeURIComponent(String(limit))}`);\n    const json = await fetchJson<any>(url, { method: 'GET', headers: this.headers() }, this.timeoutMs);\n    return EventsResponseSchema.parse(json);\n  }\n\n  /** Convenience: stream events by polling. */\n  async *pollEvents(params?: { intervalMs?: number; limit?: number; stopSignal?: AbortSignal }) {\n    const intervalMs = params?.intervalMs ?? 1000;\n    const limit = params?.limit ?? 200;\n    const seen = new Set<string>();\n\n    while (!params?.stopSignal?.aborted) {\n      const res = await this.events(limit);\n      for (const ev of res.events) {\n        const key = ev.id ? `id:${ev.id}` : `${ev.ts}:${ev.type}:${ev.signature ?? ''}:${ev.mint ?? ''}`;\n        if (seen.has(key)) continue;\n        seen.add(key);\n        yield ev;\n      }\n      await new Promise((r) => setTimeout(r, intervalMs));\n    }\n  }\n}\n"],"mappings":"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","names":[]}